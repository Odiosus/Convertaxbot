import telebot
from —ÅonfigConvertaxBot import TOKEN
from extensionsConvertaxBot import APIException, Converter, currency


# –£–∫–∞–∑—ã–≤–∞–µ–º –¢–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–æ—Ç—É
bot = telebot.TeleBot(TOKEN)


# –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç. –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª –°–ø–∏—Å–æ–∫ –≤–∞–ª—é—Ç –∏ –ü–æ–º–æ—â—å –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º —Å—Å—ã–ª–∫–∞–º-–∫–æ–º–∞–Ω–¥–∞–º.
start_txt = "–ü—Ä–∏–≤–µ—Ç! –Ø –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é –≤–∞–ª—é—Ç—ã. –í–≤–µ–¥–∏ –∫–æ–º–∞–Ω–¥—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ: \
\n_<–∏—Å—Ö–æ–¥–Ω–∞—è –≤–∞–ª—é—Ç–∞> <–≤–∞–ª—é—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è> <–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ö–æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã>_. \n\n*–ü—Ä–∏–º–µ—Ä:* —Ä—É–±–ª—å –¥–æ–ª–ª–∞—Ä 99 \
\n\n–°–ø–∏—Å–æ–∫ –≤–∞–ª—é—Ç üëâ /values \n–ü–æ–º–æ—â—å üëâ /help"

# –¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞ –ü–æ–º–æ—â–∏ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ–ø–∏–ø–∞—Å—Ç–∞ –≤–∞–ª—é—Ç—ã –≤ –æ–¥–∏–Ω —Ç—ã–∫.
help_txt = ("–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫? –¢–æ–≥–¥–∞ –¥–∞–≤–∞–π –ø–æ –ø—É–Ω–∫—Ç–∞–º: \n1. –°–æ–±–ª—é–¥–∞–π –ø–æ—Ä—è–¥–æ–∫: \
\n_<–∏—Å—Ö–æ–¥–Ω–∞—è –≤–∞–ª—é—Ç–∞>_ ‚Äî —Ç–∞, —á—Ç–æ –≤ –∫–∞—Ä–º–∞–Ω–µ;\n_<–≤–∞–ª—é—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è>_ ‚Äî —Ç–∞, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—á–µ—Ç—Å—è;\
\n_<–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ö–æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã>_ ‚Äî —Å–∫–æ–ª—å–∫–æ –µ—Å—Ç—å –≤ –∫–∞—Ä–º–∞–Ω–µ.\n2. –ù–µ –∑–∞–±—ã–≤–∞–π –ø—Ä–æ–±–µ–ª—ã. \
\n3. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ö–æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã —É–∫–∞–∑—ã–≤–∞–π —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º ‚Äî –∫–æ–ø–µ–π–∫–∏ –¥–ª—è –Ω–µ—É–¥–∞—á–Ω–∏–∫–æ–≤.\n\n*–ü—Ä–∏–º–µ—Ä: —Ä—É–±–ª—å –¥–æ–ª–ª–∞—Ä 99* \
\n\n–°–æ–≤—Å–µ–º –¥–ª—è –ª–µ–Ω–∏–≤—ã—Ö. –¢—É—Ç üëá –º–æ–∂–Ω–æ —Ç—ã–∫–Ω—É—Ç—å –Ω–∞ –≤–∞–ª—é—Ç—É, —á—Ç–æ–±—ã –µ—ë —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å (–¥–∞–∂–µ –ø—Ä–æ–±–µ–ª—ã —Å—Ç–∞–≤–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ! –°–∫–∞–∑–∫–∞!): \
\n|  `—Ä—É–±–ª—å `|  `–¥–æ–ª–ª–∞—Ä `|  `–µ–≤—Ä–æ `|  `—Ä—É–ø–∏—è `|")


# –°—Ç–∞—Ä—Ç –±–æ—Ç–∞
@bot.message_handler(commands=['start'])
def start(message):
    # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    bot.send_message(message.from_user.id, start_txt, parse_mode='Markdown')


# –†–∞–∑–¥–µ–ª –ø–æ–º–æ—â–∏ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
@bot.message_handler(commands=['help'])
def help(message: telebot.types.Message):
    # –¢–µ–∫—Å—Ç –ø–æ–º–æ—â–∏ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
    bot.reply_to(message, help_txt, parse_mode='Markdown')


# –†–∞–∑–¥–µ–ª –°–ø–∏—Å–∫–∞ –≤–∞–ª—é—Ç
@bot.message_handler(commands=['values'])
def values(message: telebot.types.Message):
    # –¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞ –°–ø–∏—Å–æ–∫ –≤–∞–ª—é—Ç. –°–ø–∏—Å–æ–∫ –∑–∞–±–∏—Ä–∞–µ–º –∏–∑ –í–∞–ª—é—Ç–Ω–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è.
    values_txt = '*–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞–ª—é—Ç—ã:*'
    for key in currency.keys():
        values_txt = '\n'.join((values_txt, key,))
    bot.reply_to(message, values_txt, parse_mode='Markdown')


# –†–∞–∑–¥–µ–ª –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞
@bot.message_handler(content_types=['text', ])
def convert(message: telebot.types.Message):
    try:
        # –°–∫–ª–µ–∏–≤–∞–µ–º –ø—Ä–æ–±–µ–ª–æ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
        options = message.text.split(' ')

        if len(options) != 3:
            raise APIException('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ üîô')

        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
        quote, base, amount = options
        # –í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–ª–∞—Å—Å–∞ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π
        total_base = Converter.get_price(quote, base, amount)
    # –°–æ–æ–±—â–∞–µ–º –æ–± –æ—à–∏–±–∫–∞—Ö
    except APIException as e:
        bot.reply_to(message, f'‚õîÔ∏è–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –æ—à–∏–±–∫–∞\n{e}')
    except Exception as e:
        bot.reply_to(message, f'‚ö†Ô∏è–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—É\n{e}')
    else:
        # –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
        text = f'–¶–µ–Ω–∞ {amount} {quote} ‚Äî {total_base} {base}'
        bot.send_message(message.chat.id, text)


bot.polling()
